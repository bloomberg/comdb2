main db vars
TESTCASE=mismatch_class_remsql
DBNAME=mismatchclassremsql69220
DBDIR=/tmp/test_19407/mismatchclassremsql69220
TESTSROOTDIR=/bb/bigstorn/systems/dhogea/comdb2/OPEN/c111/tests
TESTDIR=/tmp/test_19407
CDB2_OPTIONS=--cdb2cfg /tmp/test_19407/mismatchclassremsql69220/comdb2db.cfg
CDB2_CONFIG=/tmp/test_19407/mismatchclassremsql69220/comdb2db.cfg
SECONDARY_DBNAME=srcdbmismatchclassremsql69220
SECONDARY_DBDIR=/tmp/test_19407/srcdbmismatchclassremsql69220
SECONDARY_CDB2_CONFIG=
SECONDARY_CDB2_CONFIG not set



+ [[ '' == 1 ]]
+ echo '!mismatch_class_remsql: stopping'
!mismatch_class_remsql: stopping
+ '[' -z /tmp/test_19407 ']'
+ '[' -z /tmp/test_19407/tmp ']'
+ successful=
+ unsetup_db
+ [[ '' -eq 1 ]]
+ [[ '' -eq 1 ]]
+ [[ '' -eq 1 ]]
+ [[ '' -eq 1 ]]
+ [[ -z '' ]]
+ cdb2sql --cdb2cfg /tmp/test_19407/mismatchclassremsql69220/comdb2db.cfg mismatchclassremsql69220 default 'exec procedure sys.cmd.send("flush")'
+ sleep 1
(out='ckpt lsn: 1:1537852')
+ sleep 1
+ cdb2sql --cdb2cfg /tmp/test_19407/mismatchclassremsql69220/comdb2db.cfg mismatchclassremsql69220 default 'exec procedure sys.cmd.send("reql events off")'
+ kill_by_pidfile /tmp/test_19407/tmp/mismatchclassremsql69220.pid
+ local pidfile=/tmp/test_19407/tmp/mismatchclassremsql69220.pid
+ [[ -f /tmp/test_19407/tmp/mismatchclassremsql69220.pid ]]
++ cat /tmp/test_19407/tmp/mismatchclassremsql69220.pid
+ local pid=150886
++ grep comdb2
++ ps -p 150886 -o args
+ local 'pstr=/bb/bigstorn/systems/dhogea/comdb2/OPEN/c111/NOENV/db/comdb2 mismatchclassremsql69220 --no-global-lrl --pidfile /tmp/test_19407/tmp/mismatchclassremsql69220.pid'
+ grep -q 'comdb2 mismatchclassremsql69220'
+ echo /bb/bigstorn/systems/dhogea/comdb2/OPEN/c111/NOENV/db/comdb2 mismatchclassremsql69220 --no-global-lrl --pidfile /tmp/test_19407/tmp/mismatchclassremsql69220.pid
+ [[ 0 -eq 0 ]]
+ echo 'mismatch_class_remsql: killing 150886'
mismatch_class_remsql: killing 150886
++ xargs basename
++ echo /bb/bigstorn/systems/dhogea/comdb2/OPEN/c111/NOENV/db/comdb2 mismatchclassremsql69220 --no-global-lrl --pidfile /tmp/test_19407/tmp/mismatchclassremsql69220.pid
++ awk '{ print $1 }'
+ '[' comdb2 = comdb2 ']'
+ kill -9 150886
+ rm -f /tmp/test_19407/tmp/mismatchclassremsql69220.pid
+ cleanup_cluster
+ local 'deregister_db_port=pgrep pmux > /dev/null && (exec 3<>/dev/tcp/localhost/5105; echo del comdb2/replication/mismatchclassremsql69220 >&3 )'
+ local dbport
+ [[ -z '' ]]
++ /bb/bigstorn/systems/dhogea/comdb2/OPEN/c111/tests/tools/send_msg_port.sh -h njlxdev2 'get comdb2/replication/mismatchclassremsql69220' 5105
+ dbport=19071
+ echo 'deregistering mismatchclassremsql69220 (port 19071) from njlxdev2 pmux:5105'
deregistering mismatchclassremsql69220 (port 19071) from njlxdev2 pmux:5105
+ eval pgrep pmux '>' /dev/null '&&' '(exec' '3<>/dev/tcp/localhost/5105;' echo del comdb2/replication/mismatchclassremsql69220 '>&3' ')'
++ pgrep pmux
+ local node
+ wait
+ '[' '' '!=' 0 ']'
+ '[' '' == 1 ']'
+ '[' -n srcdb ']'
+ DBNAME=srcdbmismatchclassremsql69220
+ DBDIR=/tmp/test_19407/srcdbmismatchclassremsql69220
+ CDB2_OPTIONS='--cdb2cfg /tmp/test_19407/srcdbmismatchclassremsql69220/comdb2db.cfg'
+ unsetup_db
+ [[ '' -eq 1 ]]
+ [[ '' -eq 1 ]]
+ [[ '' -eq 1 ]]
+ [[ '' -eq 1 ]]
+ [[ -z '' ]]
+ sleep 1
+ cdb2sql --cdb2cfg /tmp/test_19407/srcdbmismatchclassremsql69220/comdb2db.cfg srcdbmismatchclassremsql69220 default 'exec procedure sys.cmd.send("flush")'
(out='ckpt lsn: 1:718248')
+ sleep 1
+ cdb2sql --cdb2cfg /tmp/test_19407/srcdbmismatchclassremsql69220/comdb2db.cfg srcdbmismatchclassremsql69220 default 'exec procedure sys.cmd.send("reql events off")'
+ kill_by_pidfile /tmp/test_19407/tmp/srcdbmismatchclassremsql69220.pid
+ local pidfile=/tmp/test_19407/tmp/srcdbmismatchclassremsql69220.pid
+ [[ -f /tmp/test_19407/tmp/srcdbmismatchclassremsql69220.pid ]]
++ cat /tmp/test_19407/tmp/srcdbmismatchclassremsql69220.pid
+ local pid=151003
++ grep comdb2
++ ps -p 151003 -o args
+ local 'pstr=/bb/bigstorn/systems/dhogea/comdb2/OPEN/c111/NOENV/db/comdb2 srcdbmismatchclassremsql69220 --no-global-lrl --pidfile /tmp/test_19407/tmp/srcdbmismatchclassremsql69220.pid'
+ grep -q 'comdb2 srcdbmismatchclassremsql69220'
+ echo /bb/bigstorn/systems/dhogea/comdb2/OPEN/c111/NOENV/db/comdb2 srcdbmismatchclassremsql69220 --no-global-lrl --pidfile /tmp/test_19407/tmp/srcdbmismatchclassremsql69220.pid
+ [[ 0 -eq 0 ]]
+ echo 'mismatch_class_remsql: killing 151003'
mismatch_class_remsql: killing 151003
++ awk '{ print $1 }'
++ xargs basename
++ echo /bb/bigstorn/systems/dhogea/comdb2/OPEN/c111/NOENV/db/comdb2 srcdbmismatchclassremsql69220 --no-global-lrl --pidfile /tmp/test_19407/tmp/srcdbmismatchclassremsql69220.pid
+ '[' comdb2 = comdb2 ']'
+ kill -9 151003
+ rm -f /tmp/test_19407/tmp/srcdbmismatchclassremsql69220.pid
+ cleanup_cluster
+ local 'deregister_db_port=pgrep pmux > /dev/null && (exec 3<>/dev/tcp/localhost/5105; echo del comdb2/replication/srcdbmismatchclassremsql69220 >&3 )'
+ local dbport
+ [[ -z '' ]]
++ /bb/bigstorn/systems/dhogea/comdb2/OPEN/c111/tests/tools/send_msg_port.sh -h njlxdev2 'get comdb2/replication/srcdbmismatchclassremsql69220' 5105
+ dbport=19072
+ echo 'deregistering srcdbmismatchclassremsql69220 (port 19072) from njlxdev2 pmux:5105'
deregistering srcdbmismatchclassremsql69220 (port 19072) from njlxdev2 pmux:5105
+ eval pgrep pmux '>' /dev/null '&&' '(exec' '3<>/dev/tcp/localhost/5105;' echo del comdb2/replication/srcdbmismatchclassremsql69220 '>&3' ')'
++ pgrep pmux
+ local node
+ wait
+ '[' '' '!=' 0 ']'
+ '[' '' == 1 ']'
+ echo 'Unsetup completed'
Unsetup completed
