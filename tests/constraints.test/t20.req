-- add constraint with table alter and then satisfy it with table alter in a transaction.
drop table if exists bar
drop table if exists foo
create table foo(i int)$$
create table bar(i int)$$
begin
alter table foo {schema{int i} keys{dup "key" = i} constraints{"key" -> "bar":"pk" on delete cascade }} $$
alter table bar {schema{int i} keys{"pk" = i}} $$
commit
insert into foo values(1)
select 'shouldnt see me' from foo
insert into bar values(1)
insert into foo values(1)
select 'should see me' from foo
select 'should see me' from bar
delete from bar where 1
select 'shouldnt see me' from foo
select 'shouldnt see me' from bar
