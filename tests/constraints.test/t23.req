-- satisfy a constraint with table create and then add it with table alter in a txn
drop table if exists foo
drop table if exists bar
create table foo(i int)$$
begin
create table bar { schema { int a } keys { "a" = a } }$$
alter table foo { schema { int a } keys { "a" = a } constraints { "a" -> "bar":"a" on delete cascade } }$$
commit
insert into foo values(1)
select 'shouldnt see me' from foo
insert into bar values(1)
insert into foo values(1)
select 'should see me' from foo
select 'should see me' from bar
delete from bar where 1
select 'shouldnt see me' from foo
select 'shouldnt see me' from bar
