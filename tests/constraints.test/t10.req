# transactional create (bad case)
begin
create table c {schema{int i} keys{dup "key" = i} constraints{"key" -> <"m" : "pk">}} $$
create table m {schema{int i} keys{"pk" = i}} $$
commit

# transactional create
begin
create table m {schema{int i} keys{"pk" = i}} $$
create table c {schema{int i} keys{dup "key" = i} constraints{"key" -> <"m" : "pk">}} $$
commit

insert into c values (1)
insert into m values (1)
insert into c values (1)
insert into c values (1)
insert into c values (1)
select * from m
select * from c
truncate m
drop table m
select * from m
select * from c

# transactional truncate
begin
truncate c
truncate m
commit
select * from m
select * from c

insert into m values (1)
insert into c values (1)
insert into c values (1)
insert into c values (1)
# transactional drop & truncate (bad case)
begin
truncate c
drop table m
commit
select * from m
select * from c

# transactional drop & truncate (good case)
begin
drop table c
truncate m
commit
select * from m
select * from c

begin
drop table if exists c
drop table if exists m
commit
begin
create table m {schema{int i} keys{"pk" = i}} $$
create table c {schema{int i} keys{dup "key" = i} constraints{"key" -> <"m" : "pk">}} $$
commit

# transactional drop (bad case)
begin
drop table m
drop table c
commit
select * from m
select * from c

# transactional drop (good case)
begin
drop table c
drop table m
commit
select * from m
select * from c

begin
create table m {schema{int i} keys{"pk" = i}} $$
create table c {schema{int i} keys{dup "key" = i} constraints{"key" -> <"m" : "pk">}} $$
create table d {schema{int i} keys{dup "key" = i} constraints{"key" -> <"m" : "pk">}} $$
commit

# transactional alter (bad case 1)
alter table m {schema{int i}} $$
# transactional alter (bad case 2)
begin
alter table m {schema{int i}} $$
alter table c {schema{int i} keys{dup "key" = i}} $$
commit
# transactional alter (bad case 3)
begin
alter table c {schema{int i} keys{dup "key" = i}} $$
alter table m {schema{int i}} $$
commit
# transactional alter (bad case 4)
begin
alter table c {schema{int i} keys{dup "key" = i}} $$
alter table m {schema{int i}} $$
alter table d {schema{int i} keys{dup "key" = i}} $$
commit

# transactional alter (good case)
begin
alter table c {schema{int i} keys{dup "key" = i}} $$
alter table d {schema{int i} keys{dup "key" = i}} $$
alter table m {schema{int i}} $$
commit

# transactional alter & add (good case)
begin
alter table m {schema{int i} keys{"pk" = i}} $$
alter table c {schema{int i} keys{dup "key" = i} constraints{"key" -> <"m" : "pk">}} $$
alter table d {schema{int i} keys{dup "key" = i} constraints{"key" -> <"m" : "pk">}} $$
create table e {schema{int i} keys{dup "key" = i} constraints{"key" -> <"m" : "pk">}} $$
commit

# transactional alter & drop (bad case)
begin
drop table c
drop table d
alter table m {schema{int i}} $$
drop table e
commit

# transactional alter & drop (good case)
begin
drop table c
drop table d
drop table e
alter table m {schema{int i}} $$
commit
